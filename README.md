## Table of contents
* [Introduction](#introduction)
* [Structure](#structure)
* [Important notes](#important-notes)
* [How to run this app](#how-to-run-this-app)
* [Backend endpoints - Django](#backend-endpoints---django)
* [Available pages - React](#available-pages---react)
* [Extra](#extra)
* [Demo](#demo)

## Introduction
Argyle Operator is an admin tool, that allows them to generate landing page with Argyle Link, send email and sms messages to users 
and also display Argyle accounts assigned to user.

## Structure
- `api` - contains Django app files
- `frontend` - contains React app files
- `tools` - contains configuration files (environment settings and Dockerfile)

## Important Notes

1. Until the admin sets the Homepage Settings (`/admin/homepage/`) and the Argyle API keys (`/admin/api-keys/`), the Homepage will be blank.
2. Until the admin sets the Argyle API keys (`/admin/api-keys/`), generating user links will be returning error.


## How to run this app?

### 1. Set all environment variables
Go to the `tools/env` directory, create a new `.env` file inside, and copy the contents of the `.env.example` file into `.env`. 
Fill in all empty attributes values.

### 2. Set database credentials in the docker-compose.yml file
```  
db:
    image: postgres:13-alpine
    environment:
      POSTGRES_USER: <postgres_user>
      POSTGRES_PASSWORD: <postgress_password>
      POSTGRES_DB: <database_name>
```

### 3. Build and run backend app
#### Docker
```
# build and run backend project
cd argyle-operator
docker-compose up -d
docker-compose logs -tf

# create admin
docker-compose exec api python manage.py createsuperuser

# run frontend
cd frontend
npm install
npm start
```

#### Docker + Makefile
```
make build
make createsuperuser
make run
```

## Backend endpoints - Django
`/admin/*` - Django admin pages \
`/auth/*` - authentication endpoints \
`/users/*` - endpoints for creating/activating/deleting admin users \
`/homepage/*` - endpoints for homepage settings \
`/webhooks/*` - handling information about Argyle account connected by a user link using Argyle Webhooks \
`/generator/*` - responsible for creating new User links, displaying the user list, resending messages, etc. \
`/integrations/*` - endpoints allow setting/displaying Argyle API keys 


## Available pages - React
`/` - Homepage - available for everyone, allows the user to connect with Argyle \
`/<user_token>/` - unique link for specific user (the link is generated by admin on Generator page), allows specific user to link/unlink account with Argyle \
`/admin/login/` - the Admin login page 
`/admin/` - Admin interface with a menu: 
* Admin List (`/admin/accounts/`) - the list of all admins, allows to add a new one or deactivate existing. 
* Homepage (`/admin/homepage/`) - homepage setting, allows admins to change a homepage view 
* API (`/admin/api-keys/`) - set Argyle credentials 
* User Edits (`/admin/user-edits/`) - two forms - invitation email editor and invitation sms editor 
* Generator (`/admin/generator/`) - the form allows to create a new user link with specific data 
* User List (`/admin/user-list/`) - the list of users with opportunity to send email and sms message again, display information about linked accounts and pay allocations 
* Logout (`/admin/logout/`) - logout

## Extra
### Makefile

Run project

```
make / make run
```

Build project

```
make build
```

Stop project

```
make stop
```

Logs

```
make logs
```

Make migrations

```
make makemigrations
```

Migration

```
make migrate
```

Reset db

```
make reset-db
```

CLI

```
make cli
```

Creating new app in apps folder
```
make app app_name=<app_name>
```

Creating superuser

```make app app_name=<app_name>
make createsuperuser
```

## Demo
Here are some demos from app.


* **Homepage Settings (admin view)**

![Homepage Settings demo](https://user-images.githubusercontent.com/15730512/110350186-be571e80-8033-11eb-9dd7-f2a2ca0c496e.gif)

![Homepage Settings](https://user-images.githubusercontent.com/15730512/110350491-10983f80-8034-11eb-8422-bf959ae40ff3.png)

 
* **Admins List (admin view)**

![Admins List demo](https://user-images.githubusercontent.com/15730512/110349845-6a4c3a00-8033-11eb-9204-b357b7aa3f0e.gif)

* **Generating User Links (admin view)**

![Generator demo](https://user-images.githubusercontent.com/15730512/110350111-b13a2f80-8033-11eb-9703-3fa2ef79ea47.gif)

![Generator view](https://user-images.githubusercontent.com/15730512/110350780-59e88f00-8034-11eb-8217-c095ca3aea6f.png)

* **Users List (admin view)**

![Users List](https://user-images.githubusercontent.com/15730512/110350908-7edd0200-8034-11eb-973e-7d2c6ac01dc5.png)
![Pay Allocations view](https://user-images.githubusercontent.com/15730512/110351002-a0d68480-8034-11eb-8257-84adf05b95ea.png)


* **Mail & SMS Templates (admin view)**

![Mail and Sms Templates demo](https://user-images.githubusercontent.com/15730512/110350290-d6c73900-8033-11eb-80b3-4f60ad573c99.gif)

* **Homepage**

![User Homepage](https://user-images.githubusercontent.com/15730512/110350316-e3e42800-8033-11eb-9d87-3bc0677ad9e5.gif)

